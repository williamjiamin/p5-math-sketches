<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>p5.js Sketch Launcher</title>
    <style>
      html, body { margin: 0; padding: 0; height: 100%; overflow: hidden; }
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: #f5efe6;
        padding: 12px;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
      }
      .container {
        max-width: 1400px;
        width: 100%;
        margin: 0 auto;
        background: #fdfbf7;
        border-radius: 14px;
        box-shadow: 0 4px 24px rgba(139, 119, 101, 0.12);
        overflow: hidden;
        border: 1px solid rgba(180, 160, 140, 0.25);
        display: flex;
        flex-direction: column;
        flex: 1;
        min-height: 0;
      }
      .header {
        background: #d4b896;
        color: #3d352b;
        padding: 16px 24px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 16px;
        flex-wrap: wrap;
      }
      .header-left {
        display: flex;
        align-items: center;
        gap: 14px;
        flex-wrap: wrap;
      }
      .profile-row {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .profile-pic {
        width: 42px;
        height: 42px;
        border-radius: 50%;
        object-fit: cover;
        border: 2px solid rgba(255,255,255,0.95);
        box-shadow: 0 2px 6px rgba(0,0,0,0.12);
      }
      .profile-label {
        font-size: 11px;
        color: #5c5042;
        margin-top: 2px;
        font-weight: 500;
      }
      .profile-wrap {
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      .controls { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
      label { font-size: 14px; font-weight: 600; color: #3d352b; }
      select {
        padding: 10px 12px;
        font-size: 14px;
        border-radius: 8px;
        border: 1px solid rgba(61, 53, 43, 0.25);
        background: rgba(255,255,255,0.7);
        color: #3d352b;
        outline: none;
      }
      select option { background: #fdfbf7; color: #3d352b; }
      .body {
        background: #f0ebe3;
        padding: 10px;
        flex: 1;
        min-height: 0;
        display: flex;
        flex-direction: column;
      }
      iframe {
        width: 100%;
        flex: 1;
        min-height: 0;
        border: 0;
        border-radius: 10px;
        background: #fff;
        box-shadow: inset 0 0 0 1px rgba(180, 160, 140, 0.15);
      }
      .hint {
        color: #5c5042;
        font-size: 12px;
        font-weight: 500;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <div class="header-left">
          <div class="profile-row">
            <div class="profile-wrap">
              <img src="assets/me.png" alt="Rippa" class="profile-pic" />
              <span class="profile-label">Rippa</span>
            </div>
            <div class="profile-wrap">
              <img src="assets/kid.png" alt="Eon" class="profile-pic" />
              <span class="profile-label">Eon</span>
            </div>
          </div>
          <span class="hint">Sketch launcher — pick a sketch below.</span>
        </div>
        <div class="controls">
          <label for="sketch">Sketch</label>
          <select id="sketch">
            <option value="">-- Loading... --</option>
          </select>

          <label for="ver">p5 version</label>
          <select id="ver">
            <option value="1.11.11">1.11.11</option>
            <option value="2.2.0">2.2.0</option>
            <option value="latest">latest</option>
          </select>
        </div>
      </div>
      <div class="body">
        <iframe id="frame" title="sketch runner"></iframe>
      </div>
    </div>

    <!-- Auto-generated sketch list (works on file:// and http://).
         Regenerate with:  node update-sketches.js
         Or watch mode:    node update-sketches.js --watch -->
    <script>
      // Dynamically load sketches-list.js with cache-busting
      (function() {
        var s = document.createElement("script");
        s.src = "sketches-list.js?t=" + Date.now();
        document.head.appendChild(s);
      })();
    </script>

    <script>
      const sketchEl = document.getElementById("sketch");
      const verEl = document.getElementById("ver");
      const frame = document.getElementById("frame");

      // Turn filename into dropdown label (e.g. "1.The Number Line.js" -> "1. The Number Line")
      function labelFor(filename) {
        const base = filename.replace(/\.js$/i, "");
        return base.replace(/^(\d+)\./, "$1. ");
      }

      // Get sketch list from window.SKETCH_LIST (set by sketches-list.js).
      // Falls back to hardcoded list if the file is missing.
      function getSketchList() {
        let list = [];

        // 1) From sketches-list.js (<script> tag — works on file:// and http://)
        if (window.SKETCH_LIST && Array.isArray(window.SKETCH_LIST) && window.SKETCH_LIST.length > 0) {
          list = window.SKETCH_LIST.slice();
        }

        // 2) Hardcoded fallback (only if sketches-list.js is missing/empty)
        if (list.length === 0) {
          list.push(
            "1.The Number Line.js", "2.Interaction Line.js", "3.Make your own shape.js",
            "4.Challendge.js", "5.Negative.js", "6.Zoom.js", "7.decimal.js", "8.Absolute Value.js",
            "9.Distance Between.js", "10.Distance Between Calculation.js", "11.Coordinate.js"
          );
        }

        list.sort((a, b) => a.localeCompare(b, undefined, { numeric: true }));
        return list;
      }

      function populateSketchSelect(filenames) {
        sketchEl.innerHTML = '<option value="">-- Choose --</option>';
        filenames.forEach((fn) => {
          const opt = document.createElement("option");
          opt.value = fn;
          opt.textContent = labelFor(fn);
          sketchEl.appendChild(opt);
        });
      }

      function update() {
        const sketch = sketchEl.value;
        const v = verEl.value;
        if (!sketch) {
          frame.removeAttribute("src");
          frame.srcdoc = "<div style='font-family: Arial; padding: 16px; color:#444'>Choose a sketch above.</div>";
          return;
        }
        const url = `runner.html?sketch=${encodeURIComponent(sketch)}&v=${encodeURIComponent(v)}`;
        frame.removeAttribute("srcdoc");
        frame.src = url;
      }

      sketchEl.addEventListener("change", update);
      verEl.addEventListener("change", update);

      // Wait briefly for sketches-list.js to load (it's dynamic now), then populate
      function initSketches() {
        const list = getSketchList();
        populateSketchSelect(list);

        // Auto-load the last sketch (most recently added)
        if (list.length > 0) {
          sketchEl.value = list[list.length - 1];
        }
        update();
      }

      // Try immediately, then retry after a short delay for the dynamic script
      if (window.SKETCH_LIST && window.SKETCH_LIST.length > 0) {
        initSketches();
      } else {
        setTimeout(initSketches, 200);
      }
    </script>
  </body>
</html>
